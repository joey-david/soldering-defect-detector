<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inspection de Soudures par IA | Anomalie Soudure</title>
    <style>
      :root {
        --primary-light: #2c3e50;
        --secondary-light: #3498db;
        --light: #ecf0f1;
        --background-light: #ffffff;
        --text-light: #2c3e50;
        --success-light: #27ae60;
        --danger-light: #e74c3c;
        
        --primary-dark: #ecf0f1;
        --secondary-dark: #3498db;
        --dark: #2c3e50;
        --background-dark: #000000e3;
        --text-dark: #ecf0f1;
        --success-dark: #2ecc71;
        --danger-dark: #e74c3c;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', system-ui, sans-serif;
        transition: background 0.3s ease, color 0.3s ease;
      }

      body {
        background: var(--background);
        color: var(--text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 2rem;
      }

      body[data-theme="light"] {
        --primary: var(--primary-light);
        --secondary: var(--secondary-light);
        --background: var(--light);
        --text: var(--text-light);
        --success: var(--success-light);
        --danger: var(--danger-light);
      }

      body[data-theme="dark"] {
        --primary: var(--primary-dark);
        --secondary: var(--secondary-dark);
        --background: var(--background-dark);
        --text: var(--text-dark);
        --success: var(--success-dark);
        --danger: var(--danger-dark);
      }

      .theme-toggle {
        position: absolute;
        top: 1.5rem;
        right: 1.5rem;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text);
      }

      .container {
        background: var(--background);
        max-width: 800px;
        width: 100%;
        padding: 3rem;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        text-align: center;
        border: 1px solid var(--primary);
      }

      h1 {
        color: var(--primary);
        margin-bottom: 1.5rem;
        font-weight: 600;
      }

      .upload-section {
        border: 3px dashed var(--secondary);
        border-radius: 15px;
        padding: 3rem;
        margin: 2rem 0;
        position: relative;
      }

      .upload-section:hover {
        background: rgba(52, 152, 219, 0.05);
        transform: translateY(-2px);
      }

      .custom-upload {
        background: var(--secondary);
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.3s ease;
        display: inline-block;
        margin-top: 1rem;
      }

      .custom-upload:hover {
        opacity: 0.9;
      }

      #preview {
        max-width: 300px;
        margin: 2rem auto;
        border-radius: 10px;
        display: none;
        border: 2px solid var(--secondary);
      }

      #file-name {
        margin-top: 1rem;
        color: var(--text);
      }

      button[type="submit"], .action-button {
        background: var(--success);
        color: white;
        padding: 15px 40px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1rem;
        margin-top: 1rem;
      }

      .instruction {
        color: var(--text);
        opacity: 0.8;
        margin: 1.5rem 0;
        font-size: 0.9rem;
      }

      #error-msg {
        color: var(--danger);
        margin: 1rem 0;
        display: none;
      }

      @media (max-width: 600px) {
        .container {
          padding: 2rem 1rem;
        }
        
        .upload-section {
          padding: 2rem 1rem;
        }
        
        .theme-toggle {
          top: 1rem;
          right: 1rem;
        }
      }
    </style>
  </head>
  <body data-theme="light">
    <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
    
    <div class="container">
      <h1>üîç Syst√®me d'Inspection de Soudure par IA</h1>
      <p class="instruction">T√©l√©versez une image de soudure pour une analyse instantan√©e</p>

      <div class="action-buttons">
        <button class="action-button" onclick="prepareDataset()">Pr√©parer le Dataset</button>
        <button class="action-button" onclick="trainModel()">Entra√Æner le Mod√®le</button>
      </div>
      
      <form method="POST" action="/predict" enctype="multipart/form-data">
        <div class="upload-section" id="drop-zone">
          <input type="file" id="image" name="file" accept="image/*" hidden />
          <label for="image" class="custom-upload">
            üìÅ Choisir un fichier
          </label>
          <div id="file-name">Aucun fichier s√©lectionn√©</div>
          <div class="instruction" style="margin-top: 1rem;">
            ou glissez-d√©posez l'image ici
          </div>
        </div>

        <img id="preview" alt="Aper√ßu de l'image" />
        <div id="error-msg">Veuillez t√©l√©verser une image valide</div>

        <button type="submit">Analyser la Soudure</button>
      </form>
    </div>

    <script>
      // Gestion du th√®me
      function toggleTheme() {
        const body = document.body;
        const newTheme = body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
        body.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      }

      // D√©finir le th√®me sauvegard√©
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.body.setAttribute('data-theme', savedTheme);

      // Gestion des fichiers
      const dropZone = document.getElementById('drop-zone');
      const fileInput = document.getElementById('image');
      const preview = document.getElementById('preview');
      const fileName = document.getElementById('file-name');
      const errorMsg = document.getElementById('error-msg');

      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = 'var(--secondary)';
      });

      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        const file = e.dataTransfer.files[0];
        handleFile(file);
      });

      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        handleFile(file);
      });

      function handleFile(file) {
        if (file && file.type.startsWith('image/')) {
          errorMsg.style.display = 'none';
          fileName.textContent = file.name;
          
          const reader = new FileReader();
          reader.onload = (e) => {
            preview.src = e.target.result;
            preview.style.display = 'block';
          };
          reader.readAsDataURL(file);
        } else {
          errorMsg.style.display = 'block';
          preview.style.display = 'none';
        }
      }

      // Placeholder functions for buttons
      function prepareDataset() {
        alert('Pr√©paration du dataset...');
      }

      function trainModel() {
        alert('Entra√Ænement du mod√®le...');
      }

      function evaluateModel() {
        alert('√âvaluation du mod√®le...');
      }

      // Update the JavaScript section

      async function prepareDataset() {
          try {
              const response = await fetch('/api/prepare-dataset', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({ binary: true })
              });
              const data = await response.json();
              alert(data.message);
          } catch (error) {
              alert('Error preparing dataset: ' + error.message);
          }
      }

      async function trainModel() {
          try {
              const response = await fetch('/api/train', {
                  method: 'POST'
              });
              const data = await response.json();
              alert(data.message);
          } catch (error) {
              alert('Error training model: ' + error.message);
          }
      }

      // Update form submission
      document.querySelector('form').onsubmit = async (e) => {
          e.preventDefault();
          
          const formData = new FormData();
          formData.append('file', fileInput.files[0]);
          
          try {
              const response = await fetch('/api/predict', {
                  method: 'POST',
                  body: formData
              });
              const data = await response.json();
              
              if (data.status === 'success') {
                  alert(`Prediction: ${data.prediction}`);
              } else {
                  alert(`Error: ${data.message}`);
              }
          } catch (error) {
              alert('Error during prediction: ' + error.message);
          }
      };
    </script>
  </body>
</html>